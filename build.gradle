plugins {
    // Apply the groovy plugin to also add support for Groovy (needed for Spock)
    id 'groovy'
    id 'java'

    // Apply the java-library plugin for API and implementation separation.
    id 'java-library'
    id 'application'
    id 'application'
}

group = 'io.elastic'
version = '3.4.1-SNAPSHOT'
sourceCompatibility = '1.8'

repositories {
    mavenCentral()
    maven {
        url 'https://oss.sonatype.org/content/repositories/snapshots'
    }
}

def isReleaseBuild() {
    return !version.endsWith('SNAPSHOT')
}


dependencies {
    testRuntimeOnly 'org.codehaus.groovy:groovy-all:3.0.13'
    testImplementation 'org.spockframework:spock-junit4:2.2-groovy-3.0'
    testImplementation 'org.spockframework:spock-core:2.2-groovy-3.0'
    testImplementation 'com.github.rest-driver:rest-client-driver:2.0.0'
    testImplementation 'org.eclipse.jetty:jetty-server:9.4.1.v20170120'
    testImplementation 'com.github.tomakehurst:wiremock-jre8-standalone:2.33.2'


    implementation 'org.glassfish:javax.json:1.0.4'
    implementation 'com.rabbitmq:amqp-client:5.9.0'
    implementation 'commons-codec:commons-codec:1.10'
    implementation 'commons-io:commons-io:2.7'
    implementation 'org.apache.httpcomponents:httpclient:4.5.13'
    implementation 'com.google.inject:guice:5.1.0'
    implementation 'com.google.inject.extensions:guice-assistedinject:5.1.0'
    implementation 'ch.qos.logback:logback-classic:1.2.10'
    implementation 'ch.qos.logback.contrib:logback-json-classic:0.1.5'
    implementation 'ch.qos.logback.contrib:logback-jackson:0.1.5'
    implementation 'com.fasterxml.jackson.core:jackson-databind:2.13.2.2'
}

jar {
    manifest {
        attributes('Implementation-Vendor' : 'elastic.io Gmbh',
                'Implementation-Title': 'elastic.io Sailor form JVM',
                'Implementation-Version': archiveVersion)
    }
}

task sourceJar(type: Jar) {
    archiveClassifier = 'sources'
    from sourceSets.main.allJava
}

task javadocs(type: Javadoc) {
    source = sourceSets.main.allJava
    classpath = configurations.compileClasspath
}

task javadocJar(type: Jar, dependsOn: javadocs) {
    archiveClassifier = 'javadoc'
    from javadoc.destinationDir
}

artifacts {
    archives sourceJar
    archives javadocJar
}

wrapper {
    gradleVersion = '7.5.1'
}

